<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PixelLogic.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    #searchInput {
      width: 300px;
      padding: 10px;
      margin-bottom: 15px;
      font-size: 16px;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    li.hidden {
      display: none;
    }

    body {
      background: #9b9b9d;
    }

    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>

<body class="min-h-screen font-sans">
  <div class="max-w-6xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-3xl font-bold">PixelLogic-Beta</h1>
      <p class="text-gray-600">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–∞–Ω–∞–ª—ã, –ø–∏—à–∏—Ç–µ —Å—Ç–∞—Ç—å–∏ –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ. –¢–µ–ø–µ—Ä—å —Å –ª–∞–π–∫–∞–º–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∏
        –∫–Ω–æ–ø–∫–æ–π –ø–æ–¥–µ–ª–∏—Ç—å—Å—è.</p>
    </header>

    <div class="grid grid-cols-12 gap-6">
      <!-- sidebar channels -->
      <aside class="col-span-3 bg-white p-4 rounded-lg shadow-sm">
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-semibold">–ö–∞–Ω–∞–ª—ã</h2>
          <button id="btnNewChannel" class="text-sm px-2 py-1 bg-indigo-600 text-white rounded">–ù–æ–≤—ã–π</button>
        </div>
        <ul id="channelsList" class="space-y-2 max-h-[60vh] overflow-auto scrollbar-hide"></ul>
      </aside>

      <!-- main content -->
      <main class="col-span-6">
        <div id="channelInfo" class="bg-white p-4 rounded-lg shadow-sm mb-4">
          <h3 id="channelTitle" class="text-xl font-semibold">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª</h3>
          <p id="channelDesc" class="text-gray-600"></p>
          <div class="mt-4 flex gap-2">
            <button id="btnNewArticle" class="hidden px-3 py-1 bg-green-600 text-white rounded">–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è</button>
            <button id="btnExport" class="px-3 py-1 bg-gray-200 rounded">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
          </div>
        </div>

        <div id="articlesList" class="space-y-4"></div>
      </main>

      <!-- right panel: create forms / preview -->
      <aside class="col-span-3">
        <div id="formBox" class="bg-white p-4 rounded-lg shadow-sm">
          <h4 class="font-semibold mb-2">–§–æ—Ä–º–∞</h4>
          <div id="placeholderForm" class="text-gray-500">–ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤—ã–π" –∫–∞–Ω–∞–ª –∏–ª–∏ "–ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.</div>

          <form id="channelForm" class="hidden space-y-2">
            <input id="chName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞" class="w-full border rounded p-2" />
            <textarea id="chDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="w-full border rounded p-2" rows="3"></textarea>
            <div class="flex gap-2">
              <button type="button" id="saveChannel"
                class="px-3 py-1 bg-indigo-600 text-white rounded">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button type="button" id="cancelChannel" class="px-3 py-1 bg-gray-200 rounded">–û—Ç–º–µ–Ω–∞</button>
            </div>
          </form>

          <form id="articleForm" class="hidden space-y-2">
            <input id="aTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏" class="w-full border rounded p-2" />
            <input id="aAuthor" placeholder="–ê–≤—Ç–æ—Ä" class="w-full border rounded p-2" />
            <textarea id="aBody" placeholder="–¢–µ–∫—Å—Ç (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Markdown)" class="w-full border rounded p-2"
              rows="8"></textarea>
            <div class="flex gap-2">
              <button type="button" id="saveArticle"
                class="px-3 py-1 bg-green-600 text-white rounded">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
              <button type="button" id="cancelArticle" class="px-3 py-1 bg-gray-200 rounded">–û—Ç–º–µ–Ω–∞</button>
            </div>
          </form>
        </div>

        <div id="previewBox" class="mt-4 bg-white p-4 rounded-lg shadow-sm hidden">
          <h4 class="font-semibold">–ü—Ä–µ–≤—å—é —Å—Ç–∞—Ç—å–∏</h4>
          <div id="previewContent" class="prose max-w-none"></div>
          <div id="previewActions" class="mt-4 flex gap-3 hidden">
            <button id="likeBtn" class="px-3 py-1 bg-pink-500 text-white rounded">‚ù§Ô∏è –õ–∞–π–∫ (<span
                id="likeCount">0</span>)</button>
            <button id="shareBtn" class="px-3 py-1 bg-blue-500 text-white rounded">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
          </div>

          <div class="mt-4">
            <h5 class="font-semibold mb-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h5>
            <div id="commentsList" class="space-y-2"></div>
            <textarea id="commentInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."
              class="w-full border rounded p-2 mt-2"></textarea>
            <button id="addCommentBtn" class="mt-2 px-3 py-1 bg-indigo-600 text-white rounded">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <h2>–ü–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫—É</h2>
  <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞...">

  <ul id="itemList">
    <li>JavaScript</li>
    <li>Python</li>
    <li>Java</li>
    <li>React</li>
    <li>HTML & CSS</li>
    <li>Node.js</li>
    <li>PHP</li>
    <li>C#</li>
  </ul>

  <script>
    const searchInput = document.getElementById("searchInput");
    const items = document.querySelectorAll("#itemList li");

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
      items.forEach(item => {
        item.classList.toggle("hidden", !item.textContent.toLowerCase().includes(query));
      });
    });

    const STORAGE_KEY = 'platform_channels_demo_v2';

    function uid(prefix = '') { return prefix + Date.now().toString(36) + Math.random().toString(36).slice(2, 8); }

    function loadData() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return { channels: [] };
      try { return JSON.parse(raw); } catch (e) { console.error(e); return { channels: [] }; }
    }
    function saveData(state) { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    let state = loadData();
    let selectedChannelId = null;
    let selectedArticleId = null;

    const channelsList = document.getElementById('channelsList');
    const btnNewChannel = document.getElementById('btnNewChannel');
    const channelForm = document.getElementById('channelForm');
    const chName = document.getElementById('chName');
    const chDesc = document.getElementById('chDesc');
    const saveChannel = document.getElementById('saveChannel');
    const cancelChannel = document.getElementById('cancelChannel');

    const channelTitle = document.getElementById('channelTitle');
    const channelDesc = document.getElementById('channelDesc');
    const btnNewArticle = document.getElementById('btnNewArticle');
    const btnExport = document.getElementById('btnExport');

    const articlesList = document.getElementById('articlesList');
    const articleForm = document.getElementById('articleForm');
    const aTitle = document.getElementById('aTitle');
    const aAuthor = document.getElementById('aAuthor');
    const aBody = document.getElementById('aBody');
    const saveArticle = document.getElementById('saveArticle');
    const cancelArticle = document.getElementById('cancelArticle');

    const placeholderForm = document.getElementById('placeholderForm');
    const previewBox = document.getElementById('previewBox');
    const previewContent = document.getElementById('previewContent');
    const previewActions = document.getElementById('previewActions');
    const likeBtn = document.getElementById('likeBtn');
    const likeCount = document.getElementById('likeCount');
    const shareBtn = document.getElementById('shareBtn');
    const commentsList = document.getElementById('commentsList');
    const commentInput = document.getElementById('commentInput');
    const addCommentBtn = document.getElementById('addCommentBtn');

    function renderChannels() {
      channelsList.innerHTML = '';
      state.channels.forEach(ch => {
        const li = document.createElement('li');
        li.className = 'p-2 rounded hover:bg-gray-50 flex items-start justify-between';
        li.innerHTML = `
          <div class="flex-1">
            <button class="text-left w-full" data-id="${ch.id}"><strong>${escapeHtml(ch.name)}</strong><div class="text-xs text-gray-500">${escapeHtml(ch.description || '')}</div></button>
          </div>
          <div class="ml-2 flex gap-1">
            <button data-action="del" data-id="${ch.id}" class="text-xs px-2 py-1 bg-red-100 text-red-700 rounded">x</button>
          </div>
        `;
        channelsList.appendChild(li);
      });
    }

    function renderSelectedChannel() {
      const ch = state.channels.find(c => c.id === selectedChannelId);
      if (!ch) {
        channelTitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª';
        channelDesc.textContent = '';
        btnNewArticle.classList.add('hidden');
        articlesList.innerHTML = '';
        return;
      }
      channelTitle.textContent = ch.name;
      channelDesc.textContent = ch.description || '';
      btnNewArticle.classList.remove('hidden');

      articlesList.innerHTML = '';
      if (!ch.articles || ch.articles.length === 0) {
        articlesList.innerHTML = '<div class="bg-white p-4 rounded shadow-sm text-gray-500">–°—Ç–∞—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
        return;
      }
      ch.articles.slice().reverse().forEach(a => {
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded shadow-sm';
        card.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h4 class="font-semibold">${escapeHtml(a.title)}</h4>
              <div class="text-sm text-gray-500">by ${escapeHtml(a.author || 'Anon')} ‚Ä¢ ${new Date(a.createdAt).toLocaleString()}</div>
              <div class="text-xs text-gray-400">‚ù§Ô∏è ${a.likes || 0} ‚Ä¢ üí¨ ${(a.comments || []).length}</div>
            </div>
            <div class="flex gap-2">
              <button data-action="view" data-id="${a.id}" class="px-2 py-1 bg-indigo-600 text-white rounded text-sm">–ß–∏—Ç–∞—Ç—å</button>
              <button data-action="delArticle" data-id="${a.id}" class="px-2 py-1 bg-red-100 text-red-700 rounded text-sm">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
        `;
        articlesList.appendChild(card);
      });
    }

    function escapeHtml(s) { if (!s && s !== 0) return ''; return String(s).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])); }

    btnNewChannel.addEventListener('click', () => {
      channelForm.classList.remove('hidden');
      articleForm.classList.add('hidden');
      placeholderForm.classList.add('hidden');
      chName.value = '';
      chDesc.value = '';
    });

    cancelChannel.addEventListener('click', () => {
      channelForm.classList.add('hidden');
      placeholderForm.classList.remove('hidden');
    });

    saveChannel.addEventListener('click', () => {
      const name = chName.value.trim();
      const desc = chDesc.value.trim();
      if (!name) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞');
      const newCh = { id: uid('ch_'), name, description: desc, articles: [] };
      state.channels.push(newCh);
      saveData(state);
      renderChannels();
      channelForm.classList.add('hidden');
      selectedChannelId = newCh.id;
      renderSelectedChannel();
    });

    channelsList.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const id = btn.dataset.id;
      const action = btn.dataset.action;
      if (action === 'del') {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª –∏ –≤—Å–µ –µ–≥–æ —Å—Ç–∞—Ç—å–∏?')) return;
        state.channels = state.channels.filter(c => c.id !== id);
        if (selectedChannelId === id) selectedChannelId = null;
        saveData(state);
        renderChannels();
        renderSelectedChannel();
        return;
      }
      selectedChannelId = id;
      renderSelectedChannel();
    });

    btnNewArticle.addEventListener('click', () => {
      if (!selectedChannelId) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª');
      articleForm.classList.remove('hidden');
      channelForm.classList.add('hidden');
      placeholderForm.classList.add('hidden');
      aTitle.value = '';
      aAuthor.value = '';
      aBody.value = '';
      previewBox.classList.remove('hidden');
      previewContent.innerHTML = '';
      previewActions.classList.add('hidden');
      commentsList.innerHTML = '';
    });

    cancelArticle.addEventListener('click', () => {
      articleForm.classList.add('hidden');
      previewBox.classList.add('hidden');
      placeholderForm.classList.remove('hidden');
    });

    saveArticle.addEventListener('click', () => {
      const title = aTitle.value.trim();
      const author = aAuthor.value.trim();
      const body = aBody.value.trim();
      if (!title || !body) return alert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏');
      const ch = state.channels.find(c => c.id === selectedChannelId);
      if (!ch) return alert('–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
      const art = { id: uid('a_'), title, author, body, createdAt: Date.now(), likes: 0, comments: [] };
      ch.articles.push(art);
      saveData(state);
      articleForm.classList.add('hidden');
      previewBox.classList.add('hidden');
      renderSelectedChannel();
    });

    articlesList.addEventListener('click', (e) => {
      const el = e.target.closest('button');
      if (!el) return;
      const action = el.dataset.action;
      const id = el.dataset.id;
      const ch = state.channels.find(c => c.id === selectedChannelId);
      if (!ch) return;
      if (action === 'view') {
        const art = ch.articles.find(x => x.id === id);
        if (!art) return;
        selectedArticleId = art.id;
        previewBox.classList.remove('hidden');
        previewContent.innerHTML = renderMarkdown(art.body, art.title, art.author, art.createdAt);
        previewActions.classList.remove('hidden');
        likeCount.textContent = art.likes || 0;
        renderComments(art);
        previewBox.scrollIntoView({ behavior: 'smooth' });
        return;
      }
      if (action === 'delArticle') {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é?')) return;
        ch.articles = ch.articles.filter(x => x.id !== id);
        saveData(state);
        renderSelectedChannel();
      }
    });

    likeBtn.addEventListener('click', () => {
      const ch = state.channels.find(c => c.id === selectedChannelId);
      if (!ch) return;
      const art = ch.articles.find(x => x.id === selectedArticleId);
      if (!art) return;
      art.likes = 1;
      saveData(state);
      likeCount.textContent = art.likes;
      renderSelectedChannel();
    });

    shareBtn.addEventListener('click', () => {
      const url = window.location.href + '#article-' + selectedArticleId;
      navigator.clipboard.writeText(url).then(() => alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞: ' + url));
    });

    addCommentBtn.addEventListener('click', () => {
      const txt = commentInput.value.trim();
      if (!txt) return;
      const ch = state.channels.find(c => c.id === selectedChannelId);
      if (!ch) return;
      const art = ch.articles.find(x => x.id === selectedArticleId);
      if (!art) return;
      art.comments = art.comments || [];
      art.comments.push({ id: uid('c_'), text: txt, createdAt: Date.now() });
      saveData(state);
      commentInput.value = '';
      renderComments(art);
      renderSelectedChannel();
    });

    function renderComments(art) {
      if (!art.comments || art.comments.length === 0) {
        commentsList.innerHTML = '<div class="text-gray-500 text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
        return;
      }
      commentsList.innerHTML = '';
      art.comments.slice().reverse().forEach(c => {
        const comment = document.createElement('div');
        comment.className = 'p-2 bg-gray-50 rounded mb-2';
        comment.innerHTML = `<div class="text-sm">${escapeHtml(c.text)}</div><div class="text-xs text-gray-400 mt-1">${new Date(c.createdAt).toLocaleString()}</div>`;
        commentsList.appendChild(comment);
      });
      commentsList.innerHTML = ''
      if (!art.comments || art.comments.length === 0) {
        commentsList.innerHTML = '<div class="text-gray-500 text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
        return;
      }
      art.comments.slice().reverse().forEach(c => {
        const comment = document.createElement('div');
        comment.className = 'p-2 bg-gray-50 rounded mb-2';
        comment.innerHTML = `<div class="text-sm">${escapeHtml(c.text)}</div><div class="text-xs text-gray-400 mt-1">${new Date(c.createdAt).toLocaleString()}</div>`;
        commentsList.appendChild(comment);
      });
    }

    // Simple markdown renderer for preview


    function renderMarkdown(body, title, author, createdAt) {
      let html = `<h2 class="text-2xl font-bold">${escapeHtml(title)}</h2>`;
      html += `<div class="text-sm text-gray-500">by ${escapeHtml(author || 'Anon')} ‚Ä¢ ${new Date(createdAt).toLocaleString()}</div>`;
      html += `<div class="mt-4">${body.replace(/\n/g, '<br>')}</div>`;
      return html;
    }
    btnExport.addEventListener('click', () => {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state, null, 2));
      const dlAnchor = document.createElement('a');
      dlAnchor.setAttribute("href", dataStr);
      dlAnchor.setAttribute("download", "channels_data.json");
      document.body.appendChild(dlAnchor);
      dlAnchor.click();
      dlAnchor.remove();
    });
    renderChannels();
    renderSelectedChannel();
    if (window.location.hash.startsWith('#article-')) {
      const artId = window.location.hash.replace('#article-', '');
      for (const ch of state.channels) {
        const art = ch.articles.find(a => a.id === artId);
        if (art) {
          selectedChannelId = ch.id;
          selectedArticleId = art.id;
          renderSelectedChannel();
          previewBox.classList.remove('hidden');
          previewContent.innerHTML = renderMarkdown(art.body, art.title, art.author, art.createdAt);
          previewActions.classList.remove('hidden');
          likeCount.textContent = art.likes || 0;
          renderComments(art);
          break;
        }
      }
    }

    function renderComments(art) {
      commentsList.innerHTML = '';
      if (!art.comments || art.comments.length === 0) {
        commentsList.innerHTML = '<div class="text-gray-500 text-sm">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
        return;
      }
      art.comments.slice().reverse().forEach(c => {
        const comment = document.createElement('div');
        comment.className = 'p-2 bg-gray-50 rounded mb-2';
        comment.innerHTML = `<div class="text-sm">${escapeHtml(c.text)}</div><div class="text-xs text-gray-400 mt-1">${new Date(c.createdAt).toLocaleString()}</div>`;
        commentsList.appendChild(comment);
      });
    }

    function renderMarkdown(body, title, author, createdAt) {
      let html = `<h2 class="text-2xl font-bold">${escapeHtml(title)}</h2>`;
      html += `<div class="text-sm text-gray-500">by ${escapeHtml(author || 'Anon')} ‚Ä¢ ${new Date(createdAt).toLocaleString()}</div>`;
      html += `<div class="mt-4">${body.replace(/\n/g, '<br>')}</div>`;
      return html;
    }

    btnExport.addEventListener('click', () => {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state, null, 2));
      const dlAnchor = document.createElement('a');
      dlAnchor.setAttribute("href", dataStr);
      dlAnchor.setAttribute("download", "channels_data.json");
      document.body.appendChild(dlAnchor);
      dlAnchor.click();
      dlAnchor.remove();
    }); 
  
  </script>

</body>

</html>